<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Ecosystem Monitoring Decision Support</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f0f4f8;
        }

        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }

        header {
            background-color: #1e90ff;
            color: white;
            padding: 10px 20px;
            text-align: center;
        }

        .main-content {
            display: flex;
            flex: 1;
        }

        .map-section {
            position: relative;
            flex: 7; /* 70%宽度 */
            background-color: #2a2a2a;
            overflow: hidden;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .overlay-data {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 10px;
            border-radius: 5px;
        }

        .overlay-item {
            margin: 5px 0;
        }

        .sidebar {
            flex: 3; /* 30%宽度 */
            background-color: #e0e7f0;
            padding: 20px;
            overflow-y: auto;
        }

        .decision-section, .visualization-section, .time-series-section {
            margin-bottom: 20px;
        }

        .decision-panel h2, .visualization-panel h2, .time-series-panel h2 {
            margin-top: 0;
        }

        .data-item {
            margin: 15px 0;
        }

        .progress-bar {
            width: 100%;
            background-color: #ddd;
            border-radius: 5px;
            overflow: hidden;
        }

        .progress {
            height: 20px;
            background-color: #1e90ff;
            text-align: right;
            padding-right: 10px;
            color: white;
        }

        .chart-container {
            width: 100%;
            height: 200px;
            margin-top: 10px;
        }

        .video-container {
            width: 100%;
            height: 200px;
            margin-top: 10px;
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        footer {
            background-color: #1e90ff;
            color: white;
            padding: 10px;
            text-align: center;
        }

        .footer-links a {
            color: white;
            margin: 0 15px;
            text-decoration: none;
        }

        .footer-links a:hover {
            text-decoration: underline;
        }

        button {
            background-color: #1e90ff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        button:hover {
            background-color: #1669d1;
        }

        input[type="number"] {
            padding: 5px;
            margin-right: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
        }
    </style>
    <!-- Leaflet and Chart.js CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>生态监测决策支持平台</h1>
            <p id="current-time">2025-08-26 03:55 CST</p>
        </header>
        <div class="main-content">
            <div class="map-section">
                <div id="map"></div>
                <div class="overlay-data">
                    <div class="overlay-item">
                        <span>生态健康指数</span>
                        <span>85%</span>
                    </div>
                    <div class="overlay-item">
                        <span>警报级别</span>
                        <span>低</span>
                    </div>
                    <div class="overlay-item" id="annotation-overlay">
                        <span>实时标注</span>
                        <span>加载中...</span>
                    </div>
                </div>
            </div>
            <div class="sidebar">
                <div class="decision-section">
                    <h2>决策建议</h2>
                    <ul>
                        <li>生物多样性稳定，无需干预。</li>
                        <li>建议定期监测棘冠海星种群。</li>
                        <li>潜在风险：气候变化影响。</li>
                    </ul>
                    <button onclick="alert('报告生成中...')">生成报告</button>
                </div>
                <div class="visualization-section">
                    <h2>交互式EDA可视化</h2>
                    <div class="data-item">
                        <label>空间分布热图</label>
                        <div class="chart-container">
                            <canvas id="heatmap"></canvas>
                        </div>
                    </div>
                    <div class="data-item">
                        <label>边界框分布柱状图</label>
                        <div class="chart-container">
                            <canvas id="barChart"></canvas>
                        </div>
                    </div>
                    <div class="data-item">
                        <label>增强视频序列</label>
                        <div class="video-container">
                            <video controls>
                                <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
                                您的浏览器不支持视频标签。
                            </video>
                        </div>
                    </div>
                </div>
                <div class="time-series-section">
                    <h2>时序分析</h2>
                    <div class="data-item">
                        <label>自定义时间窗口 (分钟)</label>
                        <input type="number" id="time-window" min="1" value="30">
                        <button onclick="updateTimeSeries()">更新曲线</button>
                    </div>
                    <div class="data-item">
                        <label>生态动态曲线</label>
                        <div class="chart-container">
                            <canvas id="timeSeries"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <footer>
            <div class="footer-links">
                <a href="/">首页</a>
                <a href="#">数据筛选</a>
                <a href="#">生物多样性</a>
                <a href="#">记者中心</a>
                <a href="#">监控视频</a>
            </div>
        </footer>
    </div>
    <!-- Leaflet and Chart.js JS -->
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
    <script>
        // 初始化地图，定位到南海（约北纬10°，东经115°）
        var map = L.map('map').setView([10, 115], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
        }).addTo(map);

        // 模拟实时标注叠加
        function updateAnnotations() {
            const overlay = document.getElementById('annotation-overlay');
            const detections = Math.floor(Math.random() * 5); // 随机模拟检测数量
            const confidence = (Math.random() * 0.5 + 0.5).toFixed(2); // 0.5-1.0
            overlay.children[1].textContent = `${detections} 个目标, 置信度: ${confidence}`;
        }
        updateAnnotations();
        setInterval(updateAnnotations, 2000); // 每2秒更新

        // 实时更新时间（北京时间）
        function updateTime() {
            const now = new Date();
            const options = {
                year: 'numeric', month: '2-digit', day: '2-digit',
                hour: '2-digit', minute: '2-digit',
                timeZone: 'Asia/Shanghai', // 北京时间 (CST, UTC+8)
                hour12: false
            };
            const timeString = now.toLocaleString('en-US', options).replace(/,/, '').replace(/\//g, '-') + ' CST';
            document.getElementById('current-time').textContent = timeString;
        }
        updateTime(); // 初始调用
        setInterval(updateTime, 1000); // 每秒更新

        // 初始化空间分布热图
        const heatmapCtx = document.getElementById('heatmap').getContext('2d');
        new Chart(heatmapCtx, {
            type: 'scatter', // 模拟热图
            data: {
                datasets: [{
                    label: '空间分布密度',
                    data: Array.from({ length: 50 }, () => ({
                        x: Math.random() * 20,
                        y: Math.random() * 20,
                        r: Math.random() * 10 + 5 // 点大小模拟密度
                    })),
                    backgroundColor: 'rgba(30, 144, 255, 0.6)'
                }]
            },
            options: {
                scales: { x: { title: { display: true, text: '经度' } }, y: { title: { display: true, text: '纬度' } } },
                plugins: { legend: { display: false } }
            }
        });

        // 初始化边界框分布柱状图
        const barCtx = document.getElementById('barChart').getContext('2d');
        new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: ['0-10', '10-20', '20-30', '30-40', '40+'],
                datasets: [{
                    label: '边界框数量',
                    data: Array.from({ length: 5 }, () => Math.floor(Math.random() * 20)),
                    backgroundColor: '#1e90ff'
                }]
            },
            options: {
                scales: { y: { beginAtZero: true, title: { display: true, text: '数量' } } },
                plugins: { legend: { display: false } }
            }
        });

        // 模拟时序曲线更新
        function updateTimeSeries() {
            const window = document.getElementById('time-window').value;
            const timeSeriesCtx = document.getElementById('timeSeries').getContext('2d');
            if (window.timeSeriesChart) window.timeSeriesChart.destroy();
            window.timeSeriesChart = new Chart(timeSeriesCtx, {
                type: 'line',
                data: {
                    labels: Array.from({ length: 10 }, (_, i) => `${i * window} min`),
                    datasets: [{
                        label: '海星密度',
                        data: Array.from({ length: 10 }, () => Math.random() * 100),
                        borderColor: '#1e90ff',
                        fill: false
                    }]
                },
                options: {
                    scales: { y: { beginAtZero: true, title: { display: true, text: '密度 (%)' } } },
                    plugins: { legend: { display: true } }
                }
            });
            alert(`更新时序分析，窗口: ${window} 分钟`);
        }
        updateTimeSeries(); // 初始调用
    </script>
</body>
</html>